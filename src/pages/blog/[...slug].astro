---
import { getEntry } from "astro:content";
import DetailLayout from "../../layouts/DetailLayout.astro";
import { marked } from "marked";

export async function getStaticPaths() {
    const blogEntry = await getEntry("blog", "data");
    const posts = blogEntry?.data || [];

    return posts.map((post) => ({
        params: { slug: post.slug },
        props: { post },
    }));
}

const { post } = Astro.props;

// Configure marked for better rendering
marked.setOptions({
    gfm: true,
    breaks: true,
});

// Render markdown content to HTML
const contentHtml = post.content ? marked(post.content) : "";
---

<DetailLayout
    title={post.title}
    subtitle={post.subtitle}
    tags={post.tags}
    color="purple"
    backLink="/blog"
    backText="Blog"
>
    <!-- Display post metadata -->
    <div class="mb-8 flex flex-wrap items-center gap-4 text-gray-400">
        <div class="flex items-center gap-2">
            <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
            >
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
            <span>{post.date}</span>
        </div>
        {
            post.category && (
                <div class="px-3 py-1 rounded-full bg-neon-purple/10 border border-neon-purple/30 text-neon-purple text-sm">
                    {post.category}
                </div>
            )
        }
    </div>

    {
        post.image && (
            <div class="mb-12 rounded-xl overflow-hidden border border-white/10 bg-white/5">
                <img
                    src={post.image}
                    alt={post.title}
                    class="w-full h-auto object-cover max-h-[500px]"
                />
            </div>
        )
    }

    <!-- Render markdown content -->
    <div
        class="prose prose-invert prose-lg max-w-none"
        set:html={contentHtml}
    />
</DetailLayout>
