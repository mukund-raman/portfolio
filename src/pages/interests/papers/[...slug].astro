---
import { getEntry } from "astro:content";
import DetailLayout from "../../../layouts/DetailLayout.astro";
import { marked } from "marked";

import markedKatex from "marked-katex-extension";

export async function getStaticPaths() {
    const papersEntry = await getEntry("papers", "data");
    const papers = papersEntry?.data || [];

    return papers.map((paper) => ({
        params: { slug: paper.slug },
        props: { paper },
    }));
}

const { paper } = Astro.props;

// Configure marked for better rendering
marked.use(markedKatex({ throwOnError: false, nonStandard: true }));
marked.setOptions({
    gfm: true,
    breaks: true,
});

// Render markdown content to HTML
const contentHtml = paper.content ? marked(paper.content) : "";
---

<DetailLayout
    title={paper.title}
    subtitle={`${paper.conference} ${paper.year || ""}`}
    tags={paper.tags || []}
    color="purple"
    backLink="/interests"
    backText="Interests"
>
    <!-- Paper metadata -->
    <div class="mb-8 space-y-4">
        <div class="p-6 rounded-xl bg-white/5 border border-white/10">
            <div class="grid md:grid-cols-2 gap-4">
                <div>
                    <h3
                        class="text-sm uppercase tracking-wider text-gray-500 mb-2"
                    >
                        Authors
                    </h3>
                    <p class="text-gray-300">{paper.authors.join(", ")}</p>
                </div>
                <div>
                    <h3
                        class="text-sm uppercase tracking-wider text-gray-500 mb-2"
                    >
                        Conference
                    </h3>
                    <p class="text-neon-purple font-semibold">
                        {paper.conference}
                        {paper.year}
                    </p>
                </div>
            </div>
            {
                paper.link && (
                    <div class="mt-4 pt-4 border-t border-white/10">
                        <a
                            href={paper.link}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-neon-purple/10 border border-neon-purple/30 text-neon-purple hover:bg-neon-purple/20 transition-colors"
                        >
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                width="16"
                                height="16"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                            >
                                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" />
                                <polyline points="15 3 21 3 21 9" />
                                <line x1="10" y1="14" x2="21" y2="3" />
                            </svg>
                            Read Paper on arXiv
                        </a>
                    </div>
                )
            }
        </div>
    </div>

    <!-- Render markdown content -->
    {
        contentHtml && (
            <div
                class="prose prose-invert prose-lg max-w-none"
                set:html={contentHtml}
            />
        )
    }
</DetailLayout>
