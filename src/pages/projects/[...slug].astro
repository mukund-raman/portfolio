---
import { getEntry } from "astro:content";
import DetailLayout from "../../layouts/DetailLayout.astro";
import { marked } from "marked";

import markedKatex from "marked-katex-extension";

export async function getStaticPaths() {
    const projectsEntry = await getEntry("projects", "data");
    const projects = projectsEntry?.data || [];

    return projects.map((project) => ({
        params: { slug: project.slug },
        props: { project },
    }));
}

const { project } = Astro.props;

// Configure marked for better rendering
marked.use(markedKatex({ throwOnError: false, nonStandard: true }));
marked.setOptions({
    gfm: true,
    breaks: true,
});

// Render markdown content to HTML
const contentHtml = project.content ? marked(project.content) : "";
---

<DetailLayout
    title={project.title}
    subtitle={project.subtitle}
    tags={project.tags}
    color="gold"
    backLink="/projects"
    backText="Projects"
>
    <div
        class="mb-12 rounded-xl overflow-hidden border border-white/10 bg-white/5"
    >
        <!-- Display project image if available -->
        {
            project.image && (
                <img
                    src={project.image}
                    alt={project.title}
                    class="w-full h-auto object-cover max-h-[500px]"
                />
            )
        }
    </div>

    <div class="flex gap-4 mb-12 not-prose">
        {
            project.viewLink && (
                <a
                    href={project.viewLink}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="px-6 py-3 rounded-lg bg-neon-gold text-black font-bold hover:bg-white transition-colors"
                >
                    View Source Code
                </a>
            )
        }
        {
            project.link && project.link !== `/projects/${project.slug}` && (
                <a
                    href={project.link}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="px-6 py-3 rounded-lg border border-neon-gold text-neon-gold font-bold hover:bg-neon-gold/10 transition-colors"
                >
                    Live Demo
                </a>
            )
        }
    </div>

    <!-- Render markdown content -->
    <div
        class="prose prose-invert prose-lg max-w-none"
        set:html={contentHtml}
    />
</DetailLayout>
