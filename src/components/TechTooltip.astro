---
import skillsData from "../content/skills.yaml";
import companiesData from "../content/companies.yaml";
import type { Skill, Company } from "../types";

interface Props {
    text: string;
    type?: "skill" | "company";
    overrideClass?: string;
    color?: string; // New: Section color
}

const {
    text,
    type = "skill",
    overrideClass = "",
    color = "orange",
} = Astro.props;

// Load data from YAML collections
const allSkills = (skillsData || []) as Skill[];
const allCompanies = (companiesData || []) as Company[];

// Convert arrays to lookup objects
const SKILL_DATA = allSkills.reduce(
    (acc: Record<string, Skill>, skill: Skill) => {
        acc[skill.name] = skill;
        return acc;
    },
    {} as Record<string, any>,
);

const COMPANY_DATA = allCompanies.reduce(
    (acc: Record<string, Company>, company: Company) => {
        acc[company.name] = company;
        return acc;
    },
    {} as Record<string, any>,
);

const FALLBACK_DATA = {
    description: "A key technology in my stack.",
    tagline: "Essential Tool",
};

// Normalize key lookup
const data =
    type === "skill"
        ? SKILL_DATA[text] ||
          SKILL_DATA[
              Object.keys(SKILL_DATA).find(
                  (k) => k.toLowerCase() === text.toLowerCase(),
              ) || ""
          ] ||
          FALLBACK_DATA
        : COMPANY_DATA[text] ||
          COMPANY_DATA[
              Object.keys(COMPANY_DATA).find(
                  (k) => k.toLowerCase() === text.toLowerCase(),
              ) || ""
          ] || {
              ...FALLBACK_DATA,
              description: "Software Engineering & Technology Organization",
          };

const uniqueId = Math.random().toString(36).substring(2, 9);
---

<span
    class={`tech-tooltip-trigger inline-flex items-center justify-center cursor-default pb-0.5 ${overrideClass}`}
    data-text={text}
    data-type={type}
    data-metadata={JSON.stringify(data)}
    data-color={color}
>
    <slot />
</span>
