---
interface Props {
    title: string;
    subtitle: string;
    date?: string;
    description: string;
    tags?: string[];
    link: string;
    image?: string; // New: For grid layout
    viewLink?: string; // New: For "View Project" button
    color?: "cyan" | "red" | "gold" | "purple" | "orange" | "light-orange";
    cardType?: "project" | "blog" | "experience" | "paper" | "book"; // New: For button text
}

const {
    title,
    subtitle,
    date,
    description,
    tags = [],
    link,
    image,
    viewLink,
    color = "cyan",
    cardType = "project",
} = Astro.props;

const colorClasses = {
    cyan: "border-neon-cyan/30 hover:border-neon-cyan/50 hover:shadow-[0_0_40px_rgba(0,243,255,0.3)]",
    red: "border-neon-red/30 hover:border-neon-red/50 hover:shadow-[0_0_40px_rgba(255,0,60,0.3)]",
    gold: "border-neon-gold/30 hover:border-neon-gold/50 hover:shadow-[0_0_40px_rgba(255,215,0,0.3)]",
    purple: "border-neon-purple/30 hover:border-neon-purple/50 hover:shadow-[0_0_40px_rgba(191,0,255,0.3)]",
    orange: "border-orange-500/30 hover:border-orange-500/50 hover:shadow-[0_0_40px_rgba(249,115,22,0.3)]",
    "light-orange":
        "border-orange-300/30 hover:border-orange-300/50 hover:shadow-[0_0_40px_rgba(253,186,116,0.3)]",
};

const textColors = {
    cyan: "text-neon-cyan",
    red: "text-neon-red",
    gold: "text-neon-gold",
    purple: "text-neon-purple",
    orange: "text-orange-500",
    "light-orange": "text-orange-300",
};

const buttonText = {
    project: "View Project",
    blog: "View Blog",
    experience: "View Experience",
    paper: "View Paper",
    book: "View Book",
};

const titleColorClasses = {
    cyan: "group-hover:text-neon-cyan",
    red: "group-hover:text-neon-red",
    gold: "group-hover:text-neon-gold",
    purple: "group-hover:text-neon-purple",
    orange: "group-hover:text-orange-500",
    "light-orange": "group-hover:text-orange-300",
};
import TechTooltip from "./TechTooltip.astro";
---

<article
    class={`group relative flex flex-col h-full rounded-2xl bg-black/40 backdrop-blur-md border transition-all duration-300 overflow-hidden ${colorClasses[color]}`}
>
    <!-- Image Slot (Top) -->
    {
        image && (
            <a
                href={link}
                class="relative h-48 overflow-hidden border-b border-white/10 group-hover:brightness-110 transition-all block"
            >
                <img
                    src={image}
                    alt={title}
                    class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
                />
                <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-60" />
            </a>
        )
    }

    <div class="p-6 flex flex-col flex-grow">
        <!-- Metadata Row (Date & Badges) -->
        <div class="flex justify-between items-center mb-4">
            {
                date && (
                    <span class="text-xs font-mono text-gray-400">{date}</span>
                )
            }
            {
                subtitle && (
                    <span
                        class={`text-[10px] font-bold tracking-wider uppercase px-2 py-1 rounded bg-white/5 border border-white/10 ${textColors[color]}`}
                    >
                        {subtitle}
                    </span>
                )
            }
        </div>

        <!-- Title -->
        <a href={link} class="block">
            <h3
                class={`text-xl font-bold text-white mb-2 transition-colors ${titleColorClasses[color]}`}
            >
                {title}
            </h3>
        </a>

        <!-- Description -->
        <p
            class="text-gray-400 text-sm leading-relaxed mb-6 flex-grow line-clamp-3"
        >
            {description}
        </p>

        <!-- Tags -->
        {
            tags && tags.length > 0 && (
                <div class="flex flex-wrap gap-2 mb-6">
                    {tags.map((tag) => (
                        <TechTooltip
                            text={tag}
                            color={color === "gold" ? "yellow" : color}
                        >
                            <span class="px-2 py-1 text-[10px] uppercase tracking-wide font-medium rounded-md bg-white/5 text-gray-400 border border-white/5 group-hover:border-white/10 transition-colors">
                                {tag}
                            </span>
                        </TechTooltip>
                    ))}
                </div>
            )
        }

        <!-- Actions Footer -->
        <div
            class="flex items-center gap-3 mt-auto pt-4 border-t border-white/5"
        >
            <a
                href={link}
                class={`inline-flex items-center text-xs font-bold uppercase tracking-wide transition-all ${textColors[color]} hover:opacity-80`}
            >
                {buttonText[cardType]}
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="14"
                    height="14"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="ml-1 transition-transform group-hover:translate-x-1"
                    ><path d="M5 12h14"></path><path d="m12 5 7 7-7 7"
                    ></path></svg
                >
            </a>

            {
                viewLink && (
                    <a
                        href={viewLink}
                        class="inline-flex items-center text-xs font-bold uppercase tracking-wide text-gray-500 hover:text-white transition-colors"
                    >
                        Live Demo
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="14"
                            height="14"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            class="ml-1"
                        >
                            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" />
                            <polyline points="15 3 21 3 21 9" />
                            <line x1="10" y1="14" x2="21" y2="3" />
                        </svg>
                    </a>
                )
            }
        </div>
    </div>
</article>
